<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: apiAccess/APIAccessor/EntityAccessors/DescribableEntityAccessor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: apiAccess/APIAccessor/EntityAccessors/DescribableEntityAccessor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import SingleItemJSONValidator from '../../JSONValidators/SingleItemJSONValidator/SingleItemJSONValidator';

/** Provides a way to interface with the API, in relation to entities that have descriptions */
class DescribableEntityAccessor
{
	
	/** 
	* Create a new DescribableEntityAccessor 
	* @param {string} baseURL - The root URL of the API (e.g. "http://thisAPI.com/api/v1/")
	* @param {function} getJSONFromAPIFunc - A function that will take a path string, and a settings object 
	* (2nd argument to fetch()), and then get the data from the API
	* @param {function} addErrorFunc - A function that should be passed the text for any errors that 
	* need raising
	*/
	constructor(baseURL, getJSONFromAPIFunc, addErrorFunc)
	{
		this._baseURL = baseURL;
		this._getJSONFromAPI = getJSONFromAPIFunc;
		this._addError = addErrorFunc;
		
		const validProperties = [{ name: "description", type: "string" }];
		
		this._validator = new SingleItemJSONValidator(validProperties);
	}
	
	
	/**
	* Change the description of a schema/table/column record in the app's database, through the API (or 
	* add an error with the addErrorFunc that was passed to the constructor)
	* @param {string} entityRouteName - The name of the entity. Used like this: 
	* "http://thisAPI.com/api/v1/-entityRouteName-/-id-"
	* @param {number} id - The id of the entity record in the [schema], [table] or [column] table
	* @param {string} newDescription - The new description for the entity record
	* @return {Object} The response entity object, or an empty object if there was an error
	*/
	async updateEntityDescription(entityRouteName, id, newDescription)
	{
		try
		{
			if(typeof newDescription !== "string") 
				throw new Error("The provided description was not a valid string.");
			
			if(typeof entityRouteName !== "string") 
				throw new Error("The provided entity name was not a valid string.");
			
			const settings = {
				method: "PATCH",
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					description: newDescription
				})
			};
			
			const [recordText, record] = await this._getJSONFromAPI(
				`${this._baseURL}/${entityRouteName}/update_description/${id}`, 
				settings
			);
			
			this._validateDescriptionJSON(recordText);
			
			return record;
		}
		catch(err)
		{
			this._addError(`Error while updating record: ${err.message}`);
			return {};
		}
	}
	
	
	//Throws error
	/** 
	* Validate the given JSON text, using a SingleItemJSONValidator instance (and throw an exception if 
	* invalid)
	* @param {string} jsonText - The JSON text to be validated
	*/
	_validateDescriptionJSON(jsonText)
	{
		if(!this._validator.validateJSON(jsonText))
		{
			const firstError = this._validator.getNextError();
			
			while(this._validator.hasErrors()) this._validator.getNextError();
			
			throw new Error(firstError);
		}
	}
}

export default DescribableEntityAccessor;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AddDatabaseForm.html">AddDatabaseForm</a></li><li><a href="APIAccessor.html">APIAccessor</a></li><li><a href="App.html">App</a></li><li><a href="DatabaseEntityAccessor.html">DatabaseEntityAccessor</a></li><li><a href="DatabaseJSONValidator.html">DatabaseJSONValidator</a></li><li><a href="DbEntityAnchorMapper.html">DbEntityAnchorMapper</a></li><li><a href="DescribableEntityAccessor.html">DescribableEntityAccessor</a></li><li><a href="EntityElementIdGenerator.html">EntityElementIdGenerator</a></li><li><a href="FilterableSchemaList.html">FilterableSchemaList</a></li><li><a href="JSONArrayValidator.html">JSONArrayValidator</a></li><li><a href="JSONValidator.html">JSONValidator</a></li><li><a href="Queue.html">Queue</a></li><li><a href="SingleItemJSONValidator.html">SingleItemJSONValidator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Aug 24 2021 09:59:46 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
